<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Exploring domains with python</title>
        <meta name="viewport" content="width=device-width">

	<link href="http://fonts.googleapis.com/css?family=Merriweather:400,700|Ubuntu:400" rel="stylesheet">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">Big Ball of Code</a></h1>
            <span>- by Thomas Presthus</span>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Exploring domains with python</h2>
<p class="meta">22 Dec 2013</p>

<div class="post">
<p>I&#39;m currently working on a Proof of Concept project. But the concept isn&#39;t really finished. This leads to a rather fun path of development: Discovering the concept and exploring its domain(s) at the same time.</p>

<p>The concept I&#39;m prototyping has rather complex business logic and requirements, and we&#39;ve decided to use domain-driven design in developing it. Domain-driven design lets us define clear business goals and mechanisms, while implementing fitting software based on the actual business needs and domains. The product is further broken down into (at the moment) 2 different bounded contexts. I&#39;ll write more about bounded contexts in another post.</p>

<p>I&#39;ve chosen to start coding in the bounded context that contains our primary domain. When prototyping like this, I don&#39;t want to get bugged down by strict infrastructure, limiting frameworks or anything else. I just want to start sketching out my models in actual code. I&#39;ve found python to be a great tool for this kind of work. A dynamic, verbose language with a full-packed toolkit of standard libraries empowers me to get up and running quickly.</p>

<h3>Repositories</h3>

<p>A well-known tactical pattern of domain-driven design is the Repository. A repository encapsulates the storage and retrieval of our domain objects. Be it towards a database, event store, web service or frankly anything.</p>

<p>When prototyping, I like to keep the number of dependencies in my project down. This also adheres to one of my rules of good architecture: Good architecture lets you defer concrete decisions. E.g. allowing you to code up your domain without thinking about databases and those kind of things. Repositories serves as a nice seam in our code to isolate the domain from this kind of concerns. Another goal of domain-driven design is also to keep development focused on the model instead of technology.</p>

<p>One of my best friends in the python standard library is pickle. Pickle lets us serialize and deserialize nearly any python object or structure.</p>

<p>By using pickle, an example repository might look like this:</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">class</span> <span class="nc">AccountRepository</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;account-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">account_name</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;account-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">account_name</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">))</span>
</code></pre></div>

<p>Of course, this code could easily be refactored into a pickle-backed generic repository, serving as a quick-to-use building block in our prototype project so we won&#39;t have to worry about storage again anytime soon.</p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">PickleStorage</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

  <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

  <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">filname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AccountRepository</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>

  <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;account-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">account_name</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="s">&quot;account-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>

<p>Now we&#39;ve simply encapsulated the lifecycle management of our Account aggregate in an AccountRepository that can be replaced when the need arises. Using duck-typing, we can also switch out the storage mechanism very easily when writing tests.</p>

<h3>Summary</h3>

<p>This has been a short introduction to Repositories and how we can use them when prototyping in python. I expect to write about other concepts from domain-driven design, and other ways of utilizing python for prototyping, in future posts.</p>

</div>

<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'ballofcode'; 
	var disqus_identifier = '/python/domain-driven-design/2013/12/22/exploring-domains-with-python';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
</div>


          <div class="footer">
            <div class="contact">
              <p>
                Thomas Presthus<br />
                Consultant and owner, Erus Encodia AS<br />
                thomas@encodia.no
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://twitter.com/presthus">twitter.com/presthus</a><br />
              </p>
            </div>
          </div>
        </div>

        <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49003104-1', 'ballofcode.com');
ga('send', 'pageview');
        </script>
    </body>
</html>
